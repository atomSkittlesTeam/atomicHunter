# Инструкция по развёртыванию системы

Приложение *Atomic Hunter* состоит из клиентского веб—приложения и серверной части.
Веб-приложение разработано c помощью *Angular 15*.
Серверная часть представляет собой сервис, разработанный с помощью *Java 17* и фреймворка *Spring Boot 3*.


Для запуска на платформе Windows можно скачать собранный дистрибутив по ссылке `\\172.30.100.100\doc\team9\install\atomichunter.zip`.

---

## Инструкция по запуску Java-сервиса
Java-сервис и его окружение лежат в папке `backend`. В папке содержатся:

* atomichunter.jar - java приложение
* run.bat - файл для запуска java приложения
* application.yml - основной конфигурационный файл
* application-pg.yml - конфигурация СУБД PostgreSQL
* application-h2.yml - конфигурация СУБД h2
* application-mail.yml - конфигурационный файл, включающий в себя настройки почты (для исходящих писем)
* jre - JRE (*Вы также можете запустить jar файл с помощью установленной на вашей машине java*)

Чтобы запустить java-сервис, достаточно запустить файл `run.bat`. Перед запуском рекомендуется проверить и при необходимости отредактировать конфигурационные файлы.

 Java-сервис может быть подключен c помощью JDBC к различным СУБД. Мы гарантируем работу с *PostgreSQL* и *H2*.
 
 За выбор режима работы с соответствующей СУБД в конфигурационном файле `application.yml` есть следующая настройка: 
```
spring:
  profiles:
    active: pg,mail #для режима работы с H2 данная настройка должна принимать h2,mail
```
Вы можете отредактировать конкретные настройки подключения к СУБД в файле *application-pg.yml* или в *application-h2.yml* в зависимости от выбранного режима profiles.active в *application.yml*.
По умолчанию мы предлагаем использование PostgreSQL в качестве СУБД. Перед запуском сервиса необходимо настроить файл `application-pg.yml`. Проверьте url, username, password.

```
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/postgres
    username: postgres
    password: postgres
```

По умолчанию сервис запускается на порту 8081.

Адрес внешнего окружения прописывается в следующей настройке:
```
remoteService:
  url: "http://172.30.9.31:5000"
```

---

## Инструкция по запуску Телеграм-бота
В `application.yml` прописаны настройки телеграм-бота.

```
telegram:
  link: "http://t.me/AtomicHunterBot"
  token: "5729000727:AAEk3vHl_00K0ARTesyNpkaFN2gNlxAN4Ds"
```

В случае, если бот не нужен, в конфигурации следует прописать такие настройки:
```
telegram:
  link: "null"
  token: "null"
```

В случае параллельного запуска java-сервиса с одним и тем же токеном в консоли будет выдаваться ошибка (актуально при одновременном тестировании системы). Для удобства проверки было подготовлено несколько дополнительных пар link-token:
```
telegram:
  link: "t.me/AtomicHunter_1_Bot"
  token: "5745073165:AAGf5ijHLhprQd9ieNUKIHMRisg7YsfE-aE"
  
telegram:
  link: "t.me/AtomicHunter_2_Bot"
  token: "6267546981:AAHiU64zD47BWTt7ZdchM7awrHd-K61k4bw"
  
telegram:
  link: "t.me/AtomicHunter_3_Bot"
  token: "6151936062:AAFW_vJDc0VbTnCL8b1ODUFpTUwmKfYxoqQ"
  
telegram:
  link: "t.me/AtomicHunter_4_Bot"
  token: "6253322993:AAFqG6Umi4KdmhDlEChBthtRvtsM9y0SWKo"
```
Если предоставленных пар недостаточно, то возможно получить новый токен и название бота. Для того, чтобы создать новую пару, необходимо перейти по ссылке: `https://t.me/BotFather`. Введите `/start`, чтобы посмотреть список доступных команд. Введите `/newbot` для создания нового бота. А затем придумайте ему название. BotFather выдаст вам актуальные токен и ссылку на бота. Вставьте полученную ссылку или токен в `application.yml`.

---

## Инструкция по запуску клиента
 Запуск веб-приложения Angular осуществляется с помощью nginx. Для запуска *nginx* достаточно запустить файл *nginx.exe*, который располагается в папке `frontend/nginx`. Согласно представленным конфигурационным файлам nginx запускает приложение на порту 4242.

 Файлы клиентского приложения располагаются в папке `frontend/nginx/html`. Внутри папки `frontend/nginx/html` располагаются ресурсы приложения и конфигурационный файл `config.json`. Внутри данного конфигурационного файла вы можете изменить адрес доступа к java-сервису:
 ```
  {
    "backendUrl": "http://localhost:8081"
  }
 ```
 
 Для доступа к приложению необходимо открыть браузер и перейти на адрес *localhost:4242*. В качестве браузера рекомендуется использование *Google Chrome* актуальной версии. Если все действия были проведены успешно, то в браузере откроется приложение (страница авторизации).
